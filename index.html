<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µí•© ê¸ˆìœµ ê°€ì´ë“œ ë° ê³„ì‚°ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .guide-container { background-color: #f5f5f5; color: #333; line-height: 1.6; }
        input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
    </style>
</head>
<body class="bg-slate-50">
    <div class="max-w-7xl mx-auto p-4 md:p-6">
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <a href="https://www.notion.so/1f2ebdf111b580cdbefbe40390c5428c?v=1f2ebdf111b581229457000c8a053910" target="_blank" class="block">
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-6 shadow-lg h-40 flex flex-col justify-between text-white hover:opacity-90 transition">
                    <div><div class="text-sm font-semibold opacity-90 mb-2">ğŸ“š ë¬¸ì„œ</div><h3 class="text-2xl font-bold">ë…¸ì…˜ ë°”ë¡œê°€ê¸°</h3></div>
                    <div class="text-sm opacity-90">ë°”ë¡œê°€ê¸° â†’</div>
                </div>
            </a>
            <a href="https://ltv-flask-young.onrender.com/" target="_blank" class="block">
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 shadow-lg h-40 flex flex-col justify-between text-white hover:opacity-90 transition">
                    <div><div class="text-sm font-semibold opacity-90 mb-2">ê¸ˆìœµ ë„êµ¬</div><h3 class="text-2xl font-bold">LTVê³„ì‚°ê¸°</h3></div>
                    <div class="text-sm opacity-90">ë°”ë¡œê°€ê¸° â†’</div>
                </div>
            </a>
            <a href="https://app.loanfra.com/self_screening" target="_blank" class="block">
                <div class="bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-6 shadow-lg h-40 flex flex-col justify-between text-white hover:opacity-90 transition">
                    <div><div class="text-sm font-semibold opacity-90 mb-2">ì „ì‚° ì‹œìŠ¤í…œ</div><h3 class="text-2xl font-bold">ë¡ í”„ë¼ì „ì‚°</h3></div>
                    <div class="text-sm opacity-90">ë°”ë¡œê°€ê¸° â†’</div>
                </div>
            </a>
        </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 mb-6">
                    <h4 class="font-semibold text-slate-800 mb-4 text-lg">ğŸ“‘ ë¹ ë¥¸ ì´ë™</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button onclick="switchTab('calculator')" class="px-4 py-3 bg-blue-50 text-blue-600 hover:bg-blue-100 font-medium rounded-xl transition border border-blue-200">ê¸°íƒ€ ê³„ì‚°ê¸°</button>
                        <button onclick="switchTab('prepayment')" class="px-4 py-3 bg-red-50 text-red-600 hover:bg-red-100 font-bold rounded-xl transition border border-red-200">ì¤‘ìˆ˜ë£Œ ê³„ì‚°ê¸°</button>
                        <button onclick="switchTab('guide2')" class="px-4 py-3 bg-slate-50 text-slate-600 hover:bg-slate-100 font-medium rounded-xl transition border border-slate-200">ê°œì¸ì •ë³´ ê´€ë¦¬</button>
                        <button onclick="switchTab('guide3')" class="px-4 py-3 bg-slate-50 text-slate-600 hover:bg-slate-100 font-medium rounded-xl transition border border-slate-200">íŒŒê¸° ì§€ì¹¨</button>
                    </div>
                </div>

        <div id="prepayment" class="tab-content active">
            <div class="bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-slate-200">
                <h1 class="text-2xl font-bold mb-6 text-slate-800">ì¤‘ë„ìƒí™˜ìˆ˜ìˆ˜ë£Œ ì‹¤ì‹œê°„ ê³„ì‚° (20% í•œë„)</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="relative p-4 border rounded-2xl bg-slate-50">
                        <label class="block text-xs font-bold text-slate-500 mb-1">ëŒ€ì¶œ ê¸ˆì•¡ (ë§Œì›)</label>
                        <input type="text" id="pre_p" oninput="handlePreAmt(this)" class="w-full text-lg font-bold bg-transparent" placeholder="ê¸ˆì•¡ ì…ë ¥">
                        <div id="pre_kor" class="absolute right-4 bottom-3 text-xs text-blue-600 font-bold"></div>
                    </div>
                    <div class="p-4 border rounded-2xl bg-slate-50">
                        <label class="block text-xs font-bold text-slate-500 mb-1">ëŒ€ì¶œ ê¸ˆë¦¬ (%)</label>
                        <input type="number" id="pre_r" oninput="runPreCalc()" class="w-full text-lg font-bold bg-transparent" placeholder="ì˜ˆ: 14.9" step="0.1">
                    </div>
                    <div class="p-4 border rounded-2xl bg-slate-50">
                        <label class="block text-xs font-bold text-slate-500 mb-1">ì¤‘ìˆ˜ë£Œìœ¨ (%)</label>
                        <input type="number" id="pre_f" value="3" oninput="runPreCalc()" class="w-full text-lg font-bold bg-transparent" step="0.1">
                    </div>
                    <div class="p-4 border rounded-2xl bg-slate-50">
                        <label class="block text-xs font-bold text-slate-500 mb-1">ì‚¬ìš©ì¼ìˆ˜</label>
                        <input type="number" id="pre_d" oninput="runPreCalc()" class="w-full text-lg font-bold bg-transparent" placeholder="ë‚ ì§œ ì…ë ¥ ì‹œ ìë™ê³„ì‚°">
                    </div>
                    <div class="p-4 border rounded-2xl bg-white">
                        <label class="block text-xs font-bold text-slate-500 mb-1">ëŒ€ì¶œ ì‹¤í–‰ì¼</label>
                        <input type="text" id="pre_start" oninput="handleDateFormat(this, 'pre')" class="w-full text-lg font-semibold" placeholder="YYYY-MM-DD" maxlength="10">
                    </div>
                    <div class="p-4 border rounded-2xl bg-white">
                        <label class="block text-xs font-bold text-slate-500 mb-1">ìƒí™˜ ì˜ˆì •ì¼</label>
                        <input type="text" id="pre_end" oninput="handleDateFormat(this, 'pre')" class="w-full text-lg font-semibold" placeholder="YYYY-MM-DD" maxlength="10">
                    </div>
                </div>
                <div class="bg-blue-900 rounded-2xl p-8 text-center text-white shadow-inner">
                    <div class="text-sm opacity-80 mb-2">ì¤‘ë„ìƒí™˜ìˆ˜ìˆ˜ë£Œ</div>
                    <div id="pre_res_fee" class="text-4xl font-black mb-4">0ì›</div>
                    <div class="flex justify-between text-sm pt-4 border-t border-blue-800">
                        <span>ê³„ì‚°ëœ ì‚¬ìš©ì¼ìˆ˜</span><span id="pre_res_days" class="font-bold">0ì¼</span>
                    </div>
                </div>
                <button onclick="location.reload()" class="w-full mt-4 py-3 bg-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-300 transition">ìƒˆë¡œ ê³„ì‚°í•˜ê¸°</button>
            </div>
        </div>

        <div id="calculator" class="tab-content">
            <div class="bg-white rounded-lg p-6 md:p-8 shadow-sm border border-slate-200">
                <h1 class="text-2xl md:text-3xl font-bold mb-6">ê¸°íƒ€ í†µí•© ê³„ì‚°ê¸°</h1>

                <div class="bg-white rounded-2xl p-6 shadow-sm mb-6 border border-slate-200">
                    <h2 class="text-xl font-bold mb-4 pb-2 border-b">ë¶€ê°€ì„¸ ê³„ì‚°ê¸°</h2>
                    <div class="mb-4">
                        <label class="block mb-2 font-semibold">ë¶€ê°€ì„¸ í¬í•¨ ê¸ˆì•¡ ì…ë ¥</label>
                        <input type="text" id="vatInput" oninput="calculateVAT()" class="w-full border rounded-xl px-3 py-2" />
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block mb-2 font-semibold text-slate-500">ê³µê¸‰ê°€ì•¡</label>
                            <input type="text" id="supplyAmount" readonly class="w-full border rounded-xl px-3 py-2 bg-slate-100 font-bold" />
                        </div>
                        <div>
                            <label class="block mb-2 font-semibold text-slate-500">ë¶€ê°€ì„¸</label>
                            <input type="text" id="vatOutput" readonly class="w-full border rounded-xl px-3 py-2 bg-slate-100 font-bold" />
                        </div>
                    </div>
                    <button onclick="resetVAT()" class="px-4 py-2 rounded-xl bg-blue-500 text-white hover:bg-blue-600 transition">ì´ˆê¸°í™”</button>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm mb-6 border border-slate-200">
                    <h2 class="text-xl font-bold mb-4 pb-2 border-b">ë‚ ì§œ ê³„ì‚°ê¸°</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-lg font-semibold mb-3 text-slate-700">1. ë‚ ì§œì— ì¼ìˆ˜ ë”í•˜ê¸°</h3>
                            <input type="text" id="dateStart" oninput="handleDateFormat(this, 'add')" class="w-full border rounded-xl px-3 py-2 mb-2" placeholder="YYYY-MM-DD" maxlength="10" />
                            <input type="number" id="daysToAdd" oninput="calculateDateAddition()" class="w-full border rounded-xl px-3 py-2 mb-2" placeholder="ë”í•  ì¼ìˆ˜" />
                            <input type="text" id="dateResult" readonly class="w-full border rounded-xl px-3 py-2 bg-slate-100 mb-2" placeholder="ê²°ê³¼ ë‚ ì§œ" />
                            <button onclick="resetDateAddition()" class="text-sm text-red-500 underline">ì´ˆê¸°í™”</button>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-3 text-slate-700">2. ë‘ ë‚ ì§œ ì‚¬ì´ ì¼ìˆ˜</h3>
                            <input type="text" id="dateFrom" oninput="handleDateFormat(this, 'diff')" class="w-full border rounded-xl px-3 py-2 mb-2" placeholder="ì‹œì‘ì¼(YYYY-MM-DD)" maxlength="10" />
                            <input type="text" id="dateTo" oninput="handleDateFormat(this, 'diff')" class="w-full border rounded-xl px-3 py-2 mb-2" placeholder="ì¢…ë£Œì¼(YYYY-MM-DD)" maxlength="10" />
                            <input type="text" id="dateDifference" readonly class="w-full border rounded-xl px-3 py-2 bg-slate-100 mb-2" placeholder="ì°¨ì´ ì¼ìˆ˜" />
                            <button onclick="resetDateDifference()" class="text-sm text-red-500 underline">ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm mb-6 border border-slate-200">
                    <h2 class="text-xl font-bold mb-4 pb-2 border-b">ê³µê¸‰ìë³„ ìë™ê¸ˆì•¡ í•©ì‚°ê¸°</h2>
                    <button onclick="addSupplier()" class="px-4 py-2 rounded-xl bg-blue-500 text-white hover:bg-blue-600 transition mb-4">ê³µê¸‰ì ì¶”ê°€ +</button>
                    <div id="suppliers-container"></div>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm mb-6 border border-slate-200">
                    <h2 class="text-xl font-bold mb-4 pb-2 border-b">ê³µê¸‰ì ë¶„ë°°ê¸ˆ ê³„ì‚°ê¸°</h2>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <input type="text" id="manualTotal" oninput="updateDistribution()" class="border rounded-xl px-3 py-2" placeholder="ì´ ë¶„ë°° ê¸ˆì•¡" />
                        <div class="flex items-center gap-2">
                            <button onclick="changeSupplierCount(-1)" class="w-8 h-8 bg-slate-200 rounded text-xl">-</button>
                            <input type="number" id="supplierCount" value="2" readonly class="w-12 text-center" />
                            <button onclick="changeSupplierCount(1)" class="w-8 h-8 bg-slate-200 rounded text-xl">+</button>
                        </div>
                    </div>
                    <table class="w-full mb-4">
                        <thead class="bg-slate-50 text-sm"><tr><th class="p-2">ê³µê¸‰ì</th><th class="p-2">ìˆ˜ê¸°ì…ë ¥</th><th class="p-2">ìë™ê³„ì‚°</th></tr></thead>
                        <tbody id="distribution-table"></tbody>
                    </table>
                    <div id="distribution-summary" class="text-right font-bold text-blue-600"></div>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm mb-6 border border-slate-200">
                    <h2 class="text-xl font-bold mb-4 pb-2 border-b">ì›ê¸ˆ í¼ì„¼íŠ¸Â·ë§Œê¸°ì¼ì‹œ ëŒ€ì¶œ ê³„ì‚°ê¸°</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <input type="text" id="loan" class="border rounded-xl px-3 py-2 text-sm" oninput="handleLoanInput(event)" placeholder="ëŒ€ì¶œê¸ˆ(ì›)" />
                        <input type="number" id="annualRate" class="border rounded-xl px-3 py-2 text-sm" oninput="calculateLoan()" placeholder="ì—°ì´ìœ¨(%)" />
                        <input type="number" id="principalPct" class="border rounded-xl px-3 py-2 text-sm" oninput="calculateLoan()" placeholder="ë¶„í• ë¹„ìœ¨(%)" />
                        <input type="number" id="months" class="border rounded-xl px-3 py-2 text-sm" oninput="calculateLoan()" placeholder="ê¸°ê°„(ê°œì›”)" />
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4 text-center">
                        <div class="p-3 bg-slate-50 rounded-xl"><div class="text-xs text-slate-500">ë§¤ì›” ì›ê¸ˆ</div><div id="monthlyPrincipal" class="font-bold">-</div></div>
                        <div class="p-3 bg-slate-50 rounded-xl"><div class="text-xs text-slate-500">ì²« ë‹¬ ë‚©ì…</div><div id="firstMonthPayment" class="font-bold">-</div></div>
                        <div class="p-3 bg-slate-50 rounded-xl"><div class="text-xs text-slate-500">ë§Œê¸° ë‚©ì…</div><div id="finalMonthPayment" class="font-bold">-</div></div>
                    </div>
                    <button onclick="toggleLoanSchedule()" class="text-sm bg-slate-800 text-white px-4 py-2 rounded-xl">ìŠ¤ì¼€ì¤„ ë³´ê¸°</button>
                    <div id="scheduleContainer" class="hidden mt-4 max-h-60 overflow-y-auto border rounded-xl">
                        <table class="w-full text-xs text-right"><thead class="bg-slate-100 sticky top-0"><tr><th class="p-2">ì›”</th><th class="p-2">ì›ê¸ˆ</th><th class="p-2">ì´ì</th><th class="p-2">ì”ì•¡</th></tr></thead><tbody id="scheduleBody"></tbody></table>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                    <h2 class="text-xl font-bold mb-4 pb-2 border-b">ë‹¨ìˆœ ì´ì ê³„ì‚°ê¸°</h2>
                    <div id="dailyRateDisplay" class="text-xs text-blue-600 mb-4 font-bold"></div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <input type="text" id="loanAmount" oninput="calculateInterest()" class="border rounded-xl px-3 py-2" placeholder="ëŒ€ì¶œê¸ˆ(ë§Œì›)" />
                        <input type="text" id="annualRate2" oninput="calculateInterest()" class="border rounded-xl px-3 py-2" placeholder="ì—°ì´ìœ¨(%)" />
                        <input type="number" id="years" value="1" oninput="calculateInterest()" class="border rounded-xl px-3 py-2" />
                    </div>
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div class="p-2 bg-slate-50 rounded"><div class="text-[10px]">í•˜ë£¨</div><input type="text" id="dailyInterest" readonly class="w-full bg-transparent text-center font-bold" /></div>
                        <div class="p-2 bg-slate-50 rounded"><div class="text-[10px]">í•œë‹¬</div><input type="text" id="monthlyInterest" readonly class="w-full bg-transparent text-center font-bold" /></div>
                        <div class="p-2 bg-slate-50 rounded"><div id="yearlyLabel" class="text-[10px]">1ë…„</div><input type="text" id="yearlyInterest" readonly class="w-full bg-transparent text-center font-bold" /></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="guide2" class="tab-content">
            <div class="guide-container max-w-4xl mx-auto bg-white rounded-2xl p-6 md:p-8 shadow-sm border">
                <h1 class="text-2xl font-bold text-center border-b pb-4 mb-6">ê°œì¸ì •ë³´ ë³´ìœ Â·íŒŒê¸° ê´€ë¦¬ ê°€ì´ë“œ</h1>
                <div class="space-y-6">
                    <div class="p-4 bg-slate-50 border-l-4 border-green-500 rounded">
                        <h3 class="font-bold text-green-700 mb-2">ğŸ“‹ ê³„ì•½ ì²´ê²° ê³ ê°</h3>
                        <p class="text-sm">ë³´ìœ  ê¸°ê°„: ê±°ë˜ ì¢…ë£Œ í›„ <b>5ë…„</b> (ì‹ ìš©ì •ë³´ë²• ì œ20ì¡°ì˜2)</p>
                    </div>
                    <div class="p-4 bg-slate-50 border-l-4 border-blue-500 rounded">
                        <h3 class="font-bold text-blue-700 mb-2">ğŸ“‹ ê³„ì•½ ë¯¸ì²´ê²° ê³ ê°</h3>
                        <p class="text-sm">ë³´ìœ  ê¸°ê°„: ì‹¬ì‚¬ ì¢…ë£Œ í›„ <b>3ë…„ ì´ë‚´ íŒŒê¸°</b> (ì‹ ìš©ì •ë³´ë²• ì‹œí–‰ë ¹ ì œ17ì¡°ì˜2)</p>
                    </div>
                    <div class="p-4 bg-slate-50 border-l-4 border-red-500 rounded">
                        <h3 class="font-bold text-red-700 mb-2">ğŸ“‹ ë¯¼ì›Â·ë¶„ìŸ ê´€ë ¨ ê¸°ë¡</h3>
                        <p class="text-sm">ë³´ìœ  ê¸°ê°„: ì²˜ë¦¬ ì™„ë£Œ í›„ <b>5ë…„ ë³´ê´€</b> (ì†Œë¹„ìë³´í˜¸ë²• ë“± ì¤€ìš©)</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="guide3" class="tab-content">
            <div class="guide-container max-w-4xl mx-auto bg-white rounded-2xl p-8 shadow-sm border">
                <h1 class="text-3xl font-bold text-center mb-8">ê°œì¸ì •ë³´ íŒŒê¸° ê´€ë¦¬ ì§€ì¹¨</h1>
                <div class="prose max-w-none text-sm space-y-6">
                    <section><h2 class="font-bold border-b pb-1">ì œ1ì¡° (ëª©ì )</h2><p>ë³¸ ì§€ì¹¨ì€ (ì£¼)í¬ë§ë‹´ë³´ì»¨ì„¤íŒ…ëŒ€ë¶€ì˜ ê°œì¸ì •ë³´ íŒŒê¸° ì ˆì°¨ë¥¼ ê·œì •í•¨.</p></section>
                    <section><h2 class="font-bold border-b pb-1">ì œ5ì¡° (íŒŒê¸° ì£¼ê¸°)</h2><p>ë§¤ì›” ë§ˆì§€ë§‰ ì£¼ ê¸ˆìš”ì¼ì„ <b>'ê°œì¸ì •ë³´ íŒŒê¸°ì˜ ë‚ '</b>ë¡œ ì§€ì •í•˜ì—¬ ì •ê¸° ì‹¤í–‰í•¨.</p></section>
                    <section><h2 class="font-bold border-b pb-1">ì œ6ì¡° (íŒŒê¸° ë°©ë²•)</h2><p>ì „ìì  íŒŒì¼: ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜êµ¬ ì‚­ì œ / ì¢…ì´ ë¬¸ì„œ: íŒŒì‡„ê¸° ì´ìš© ì™„ì „ ë¶„ì‡„.</p></section>
                </div>
            </div>
        </div>

    </div>

    <script>
        const fmt = new Intl.NumberFormat("ko-KR");
        let suppliers = [{ name: "", amounts: [""] }];
        let supplierCountValue = 2;
        let manualInputs = {};

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
        }

        // ê³µí†µ ë‚ ì§œ í¬ë§· í•¨ìˆ˜ (í•˜ì´í”ˆ ìë™ì¶”ê°€)
        function handleDateFormat(obj, type) {
            let str = obj.value.replace(/[^0-9]/g, '');
            let tmp = '';
            if (str.length < 5) tmp = str;
            else if (str.length < 7) tmp = str.substr(0, 4) + '-' + str.substr(4);
            else tmp = str.substr(0, 4) + '-' + str.substr(4, 2) + '-' + str.substr(6);
            obj.value = tmp;

            // íƒ€ì…ë³„ í›„ì† ë¡œì§
            if (type === 'pre') runPreCalc();
            else if (type === 'add') calculateDateAddition();
            else if (type === 'diff') calculateDateDifference();
        }

        // --- ì¤‘ìˆ˜ë£Œ ê³„ì‚°ê¸° ë¡œì§ ---
        function handlePreAmt(obj) {
            let val = obj.value.replace(/[^0-9]/g, '');
            obj.value = val.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            const kor = document.getElementById('pre_kor');
            const num = parseInt(val) || 0;
            if (num > 0) {
                let ok = Math.floor(num / 10000);
                let man = num % 10000;
                kor.innerText = (ok > 0 ? ok + "ì–µ " : "") + (man > 0 ? man + "ë§Œ" : "") + "ì›";
            } else { kor.innerText = ""; }
            runPreCalc();
        }

        function runPreCalc() {
            const pVal = document.getElementById('pre_p').value.replace(/,/g, '');
            const p = (parseInt(pVal) || 0) * 10000;
            const r = parseFloat(document.getElementById('pre_r').value) || 0;
            const f = parseFloat(document.getElementById('pre_f').value) || 0;
            const dInput = document.getElementById('pre_d');
            
            const startStr = document.getElementById('pre_start').value;
            const endStr = document.getElementById('pre_end').value;

            if (startStr.length === 10 && endStr.length === 10) {
                const s = new Date(startStr);
                const e = new Date(endStr);
                if (!isNaN(s) && !isNaN(e)) {
                    const diff = Math.floor((e - s) / 86400000);
                    dInput.value = diff > 0 ? diff : 0;
                }
            }

            const d = parseInt(dInput.value) || 0;
            if (p > 0 && d > 0 && r > 0) {
                const limit = Math.floor(p * 0.20 * d / 365);
                const interest = Math.floor(p * (r/100) * d / 365);
                const rawFee = Math.floor(p * (f/100));
                const finalFee = Math.min(rawFee, Math.max(0, limit - interest));
                document.getElementById('pre_res_fee').innerText = fmt.format(finalFee) + "ì›";
                document.getElementById('pre_res_days').innerText = d + "ì¼";
            }
        }

        // --- ë¶€ê°€ì„¸ ê³„ì‚°ê¸° ---
        function calculateVAT() {
            const input = document.getElementById('vatInput');
            input.value = input.value.replace(/[^0-9]/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            const val = parseInt(input.value.replace(/,/g, '')) || 0;
            if (val > 0) {
                const vat = Math.floor(val / 11);
                document.getElementById('vatOutput').value = fmt.format(vat);
                document.getElementById('supplyAmount').value = fmt.format(val - vat);
            }
        }
        function resetVAT() { document.getElementById('vatInput').value = ""; document.getElementById('vatOutput').value = ""; document.getElementById('supplyAmount').value = ""; }

        // --- ë‚ ì§œ ê³„ì‚°ê¸° ë¡œì§ (ìˆ˜ì •ë¨) ---
        function calculateDateAddition() {
            const sStr = document.getElementById('dateStart').value;
            const d = parseInt(document.getElementById('daysToAdd').value) || 0;
            if (sStr.length === 10) {
                const date = new Date(sStr);
                if (!isNaN(date)) {
                    date.setDate(date.getDate() + d);
                    document.getElementById('dateResult').value = date.toISOString().split('T')[0];
                }
            }
        }
        function resetDateAddition() { document.getElementById('dateStart').value = ""; document.getElementById('daysToAdd').value = ""; document.getElementById('dateResult').value = ""; }

        function calculateDateDifference() {
            const fStr = document.getElementById('dateFrom').value;
            const tStr = document.getElementById('dateTo').value;
            if (fStr.length === 10 && tStr.length === 10) {
                const f = new Date(fStr);
                const t = new Date(tStr);
                if (!isNaN(f) && !isNaN(t)) document.getElementById('dateDifference').value = Math.ceil(Math.abs(t - f) / 86400000) + "ì¼";
            }
        }
        function resetDateDifference() { document.getElementById('dateFrom').value = ""; document.getElementById('dateTo').value = ""; document.getElementById('dateDifference').value = ""; }

        // --- ëŒ€ì¶œ ê³„ì‚°ê¸° ë° ê¸°íƒ€ (ê¸°ë³¸ ìœ ì§€) ---
        function handleLoanInput(e) {
            let val = e.target.value.replace(/[^0-9]/g, '');
            e.target.value = val.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            calculateLoan();
        }
        function calculateLoan() {
            const l = parseInt(document.getElementById('loan').value.replace(/,/g, '')) || 0;
            const r = (parseFloat(document.getElementById('annualRate').value) || 0) / 100 / 12;
            const p = (parseFloat(document.getElementById('principalPct').value) || 0) / 100;
            const m = parseInt(document.getElementById('months').value) || 0;
            if (l && m) {
                const monthlyP = (l * p) / m;
                document.getElementById('monthlyPrincipal').innerText = fmt.format(Math.round(monthlyP));
                document.getElementById('firstMonthPayment').innerText = fmt.format(Math.round(monthlyP + l * r));
                let tbody = document.getElementById('scheduleBody'); tbody.innerHTML = "";
                let bal = l;
                for(let i=1; i<=m; i++) {
                    let intr = bal * r;
                    let princ = (i === m) ? monthlyP + (l * (1-p)) : monthlyP;
                    bal -= monthlyP;
                    tbody.innerHTML += `<tr class="border-b"><td class="p-2 text-center">${i}</td><td class="p-2">${fmt.format(Math.round(princ))}</td><td class="p-2">${fmt.format(Math.round(intr))}</td><td class="p-2 text-right">${fmt.format(Math.max(0, Math.round(bal)))}</td></tr>`;
                }
                document.getElementById('finalMonthPayment').innerText = fmt.format(Math.round((m > 0 ? (monthlyP + (l * (1-p))) : 0) + (l * (1-p) + monthlyP) * r));
            }
        }
        function toggleLoanSchedule() { document.getElementById('scheduleContainer').classList.toggle('hidden'); }

        function calculateInterest() {
            const p = (parseInt(document.getElementById('loanAmount').value.replace(/,/g, '')) || 0) * 10000;
            const r = (parseFloat(document.getElementById('annualRate2').value) || 0) / 100;
            const y = parseInt(document.getElementById('years').value) || 1;
            if (p && r) {
                const yr = Math.floor(p * r * y);
                document.getElementById('yearlyInterest').value = fmt.format(yr);
                document.getElementById('monthlyInterest').value = fmt.format(Math.floor(yr / 12 / y));
                document.getElementById('dailyInterest').value = fmt.format(Math.floor(yr / 365 / y));
                document.getElementById('dailyRateDisplay').innerText = `ì¼ ì´ììœ¨: ${(r/365*100).toFixed(4)}% / ì›” ì´ììœ¨: ${(r/12*100).toFixed(4)}%`;
            }
        }

        function changeSupplierCount(d) {
            supplierCountValue = Math.max(1, supplierCountValue + d);
            document.getElementById('supplierCount').value = supplierCountValue;
            renderDistributionTable();
        }
        function updateDistribution() {
            let input = document.getElementById('manualTotal');
            input.value = input.value.replace(/[^0-9]/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            renderDistributionTable();
        }
        function renderDistributionTable() {
            const base = parseInt(document.getElementById('manualTotal').value.replace(/,/g, '')) || 0;
            let tbody = document.getElementById('distribution-table'); tbody.innerHTML = "";
            let manualSum = 0; let manualCount = 0;
            for(let i=0; i<supplierCountValue; i++) {
                let key = String.fromCharCode(65+i);
                if(manualInputs[key]) { manualSum += parseInt(manualInputs[key]); manualCount++; }
            }
            let autoAmt = Math.floor((base - manualSum) / Math.max(1, (supplierCountValue - manualCount)));
            for(let i=0; i<supplierCountValue; i++) {
                let key = String.fromCharCode(65+i);
                let amt = manualInputs[key] ? parseInt(manualInputs[key]) : autoAmt;
                tbody.innerHTML += `<tr><td class="p-2 text-center text-sm">ê³µê¸‰ì ${key}</td><td class="p-2"><input type="text" oninput="updateManual('${key}', this.value)" class="w-full border rounded px-2" value="${manualInputs[key] ? fmt.format(manualInputs[key]) : ''}"></td><td class="p-2 text-right font-semibold text-sm">${fmt.format(Math.max(0, amt))}</td></tr>`;
            }
            document.getElementById('distribution-summary').innerText = `ë¶„ë°°í•©ê³„: ${fmt.format(base)}`;
        }
        function updateManual(k, v) { manualInputs[k] = v.replace(/[^0-9]/g, ''); renderDistributionTable(); }

        function addSupplier() { suppliers.push({ name: "", amounts: [""] }); renderSuppliers(); }
        function updateAmount(si, ai, v) { suppliers[si].amounts[ai] = v.replace(/[^0-9]/g, ''); renderSuppliers(); }
        function renderSuppliers() {
            let cont = document.getElementById('suppliers-container'); cont.innerHTML = "";
            suppliers.forEach((s, si) => {
                let sum = s.amounts.reduce((a, b) => a + (parseInt(b) || 0), 0);
                cont.innerHTML += `<div class="bg-slate-50 p-4 rounded-xl mb-4 border">
                    <input type="text" placeholder="ê³µê¸‰ìëª…" class="font-bold mb-2 w-full bg-transparent border-b border-slate-200" value="${s.name}" oninput="suppliers[${si}].name=this.value">
                    ${s.amounts.map((am, ai) => `<div class="flex gap-2 mb-1"><input type="text" value="${fmt.format(am)}" oninput="updateAmount(${si}, ${ai}, this.value)" class="border rounded px-2 flex-1 h-8 text-sm"></div>`).join('')}
                    <button onclick="suppliers[${si}].amounts.push(''); renderSuppliers()" class="text-[10px] bg-slate-200 px-2 py-1 rounded mt-1">+ ê¸ˆì•¡ì¶”ê°€</button>
                    <div class="text-right font-bold text-blue-600">í•©ê³„: ${fmt.format(sum)}</div>
                </div>`;
            });
        }

        document.addEventListener('DOMContentLoaded', () => { renderSuppliers(); renderDistributionTable(); });
    </script>
</body>
</html>
